<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

    <script src="js_lib/jquery.keyframes.min.js"></script>
    <script src="js/enum.js"></script>
    <script src="js/view.js"></script>
    <script src="js/utility.js"></script>
    <script src="js/iscando.js"></script>
    <script src="js/merge.js"></script>
    <script src="js/move.js"></script>
    <script src="js/main.js"></script>
    <link rel="stylesheet" href="css/game2048battlestyle.min.css">
</head>
<body>

    <script>
    var socket = io();
    var boxMoveTime = "100ms";
    var selectedRoom = undefined;

    $(document).ready(function () {
        var size = 4;
        createMitrixDiv(size);          //畫上 Grid
        initViewer();

    });

    function gotoRoom(index) {
        socket.emit('viewer_changeroom', { roomid: index });
        selectedRoom = index;
    }

    
    function initViewer() {
        socket.emit('init_viewer');

        // server 回傳 rooms
        socket.on('send_rooms', function (result) {
            //todo:result.time
            //updateDDL(result.rooms);
        });

        $('#select-rooms').change(function () {
            var id = getSelectedRoomId();
            socket.emit('viewer_changeroom', { roomid:  id});
            $(this).blur();
            selectedRoom = id;
        });

        socket.on('viewer_changeroom_suc', function(data) {
            //todo:data.time
            //todo:data.roomid
            //todo:data.p1name
            //todo:data.p2name
        });

        // server 回傳 player進入房間
        socket.on('init_room_opposite', function (data) {
            //todo:data.time
            setMsg('player' + data.player + ' is in room');
        });

        // server 回傳 player 已ready
        socket.on('send_ready_opposite', function (data) {
            //todo: data.time

            setMsg('player' + data.player + ' is ready');
            if (data.map !== undefined) {
                //todo:
                //MappingArrayData_Oppo(data.player, data.map);
            }
        });

        // server 回傳 第一階段倒數
        socket.on('send_countdown1', function (data) {
            //todo:data.time
            var secs = data.secs;
            $('#gametimespan').text(ConvertSeconds2String(secs));
        });

        // server 回傳 第一階段倒數結束 (遊戲開始可操作)
        socket.on('send_countdown1_over', function (data) {
            //todo:data.time
        });

        // server 回傳 第二階段倒數
        socket.on('send_countdown2', function (data) {
            //todo: data.time
            var secs = data.secs;
            if (secs === undefined)
                return;
            var ss = ConvertSeconds2String(secs);
            $('#gametimespan').text(ss);
        });

        // server 回傳 第二階段倒數
        socket.on('send_countdown2_over', function (data) {
            //todo:data.time
            setMsg('Game Over!!');

        });

        // server 回傳 比賽結果(game over)
        socket.on('send_winner', function (data) {
            if (data === undefined || data === null)
                return;

            //todo:data.time
            if(data.winner !== 0)
                setMsg('winner is player' + data.winner + ' score:' + data.map[0].Score);
            else
                setMsg('game is tie ,score:' + data.map[0].Score);
        });

        socket.on('send_map', function (data) {
            //todo:data.time
    	    if (data !== undefined) {
                //todo:
    	        //MappingArrayData(data.player, data.map);
    	    }
    	});

        socket.on('disconnect_opposite', function (data) {
            //todo:data.time
	        setMsg("player" + data.player + "is left");
    	});

        socket.on('send_nickname_opposite', function(data) {
            if (data === undefined || data === null)
                return;

            //todo:data.time
            if (data.player === 1) {
                $("#p1-name-p").text(data.nickname);
            }
            else if (data.player === 2) {
                $("#p2-name-p").text(data.nickname);
            }
        });
    }

    function setMsg(msg) {
        $('#gamemsgspan').text(msg);
    }

    //function updateDDL(rooms) {
    //    //add room options to #select-rooms
    //    $('#select-rooms').empty();

    //    rooms.forEach(function(room) {
    //        $("#select-rooms").append($("<option></option>").attr("value", room.id).text(room.id));
    //    });
    //    $('#select-rooms')[0].selectedIndex = -1;

    //    if (selectedRoom !== undefined) {
    //        var prevSelected = $("#select-rooms option[value=" + selectedRoom + "]");
    //        if (prevSelected != undefined && prevSelected.length > 0) {
    //            prevSelected.selected = true;
    //        } else {
    //            $("#select-rooms option")[0].selected = true;
    //        }
    //    }
    //    else {
    //        $("#select-rooms option")[0].selected = true;
    //    }

    //    $('#select-rooms').change();
    //}

    function getSelectedRoomId() {
        return $("select#select-rooms").val();;
    }
    </script>

<div class="main-contain">

    <!--<div class="mask-body" id="mask-body" style="visibility: collapse">
        <p style="font-size: 40px;">Game Over</p>
    </div>

    <div class="box-header" style="height: 55px">
        <span class="title">2048</span>
        
        <div class="box-score">
            <p class="score-title">SCORE</p>
            <p class="score-content" id="score">0</p>
        </div>

    </div>

    <div class="box-body">
    </div>

    <select id="select-rooms">
    </select>-->

    <h1>2048觀戰</h1>

    <div id="play1viewerdivcss">
        <div id="player1viewer-scare">
            <p class="score-title">SCORE</p>
            <p class="score-content" id="score1">0</p>
        </div>
        <div id="player1viewer-name">
            <p id="p1-name-p">NAME</p>
        </div>
        <div style="clear:both;"></div>
        <div id="play1-box-body">
            <div class='box-row'>
                <div class="play1-box-column-border"></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
            </div>
            <div class='box-row'>
                <div class="play1-box-column-border"></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
            </div>
            <div class='box-row'>
                <div class="play1-box-column-border"></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
            </div>
            <div class='box-row'>
                <div class="play1-box-column-border"></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
                <div class='box'><p class='box-number'></p></div>
                <div class="play1-box-row-border"></div>
            </div>
            <div class="play1-box-column-border"></div>
        </div>

    </div>

    <p style="float:left;margin-left:20px;margin-right:20px;margin-top:120px;font-size:larger;font-weight:bold">VS</p>

    <div id="play2viewerdivcss">
        <div id="player2-scare">
            <p class="score-title">SCORE</p>
            <p class="score-content" id="score2">0</p>
        </div>
        <div id="player2-name" style="width:49%">
            <p id="p2-name-p">NAME</p>
        </div>
        <div style="clear:both;"></div>

        <div id="play2-box-body">
            <div class='box-row'>
                <div class="play2viewer-box-column-border"></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
            </div>
            <div class='box-row'>
                <div class="play2viewer-box-column-border"></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
            </div>
            <div class='box-row'>
                <div class="play2viewer-box-column-border"></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
            </div>
            <div class='box-row'>
                <div class="play2viewer-box-column-border"></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
                <div class='box2viewer'><p class='box2-number'></p></div>
                <div class="play2viewer-box-row-border"></div>
            </div>
            <div id="play2viewer-box-column-border"></div>
        </div>
    </div>



    <div id="developing-div">
        <br/>
        <span> DEVELOPING </span> <br/>
        <div>
            <span id="gametimespan"></span>
        </div>
        <div>
            <span id="gamemsgspan"></span>
        </div>
    </div>

</div>
</body>

</html>