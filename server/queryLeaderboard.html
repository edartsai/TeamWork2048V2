<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
</head>
<body>

    <style>

        /* table */
        .table {
            display: table;
            border-collapse: collapse;
            margin-top: 1em;
        }

        /* tr */
        .row {
            display: table-row;
            border: solid 1px ;
        }

        /* td , th */
        .cell1 {
            display: table-cell;
            width: 180px;
            border-right: 1px dotted #fff;
            background: #fcd6d6;
        }

        .cell2 {
            display: table-cell;
            width: 180px;
            padding-left: 10px;
            border-right: 1px dotted #fff;
            background: #eff8ff;
        }

        .cell3 {
            display: table-cell;
            width: 180px;
            padding-left: 10px;
            background: #effff0;
        }
    </style>




<script>
    var socket = io();
    var global_rowCount = 10;

    $(document).ready(function() {
        

        socket.on('sendLeaderboard', function(data) {
            $('#msglist').empty();

            AppendData({
                rowid: 'Rank',
                name: 'ID',
                score: 'Score',
                movetimes: 'Times',
                ip: 'IP',
                lbdate: 'Date'
            }, true);

            if (data === undefined || data === null || data.length <= 0)
                return;


            for (var i = 0; i < data[0].length; i++) {
                AppendData(data[0][i], false);
            }

            clearInput();
        });

        $('#btnsend').click(function() {
            var checkResult = checkInput();

            if (checkResult.result) {
                socket.emit('add_leaderboard', {
                    name: checkResult.name,
                    score: checkResult.score,
                    movetimes: checkResult.movetimes,
                    ip: checkResult.ip
                });
            }
        });

        $('#atop10').click(function() {
            global_rowCount = 10;
            SendLogin();
            $('#topTitle').text('Top' + global_rowCount);

            $('#atop10').attr('disabled', true);
            $('#atop50').attr('disabled', false);
        });

        $('#atop50').click(function () {
            global_rowCount = 50;
            SendLogin();

            $('#topTitle').text('Top' + global_rowCount); 
            $('#atop10').attr('disabled', false);
            $('#atop50').attr('disabled', true);
        });



        $('#atop10').click();
    });

        function SendLogin() {
            socket.emit('user_login', {
                rowCount: global_rowCount
            });
        }

    function AppendData(datarow, isHeader) {


        var cellClassName = "cell2";
        if (isHeader)
            cellClassName = "cell3";
        var nowStr = datarow.lbdate;
        if (!isHeader) {
            var d = new Date(datarow.lbdate);
            nowStr = d.toLocaleDateString() + ' ' + d.toLocaleTimeString();
        }

        var sortspan = $("<div></div>").addClass(cellClassName).text(datarow.rowid);
        var namespan = $("<div></div>").addClass(cellClassName).text(datarow.name);
        var scorespan = $("<div></div>").addClass(cellClassName).text(datarow.score);
        var movespan = $("<div></div>").addClass(cellClassName).text(datarow.movetimes);
        var ipspan = $("<div></div>").addClass(cellClassName).text(datarow.ip);
        var datespan = $("<div></div>").addClass(cellClassName).text(nowStr);
        var rowdiv = $("<div></div>").addClass("row").append(sortspan, namespan, scorespan, movespan, ipspan, datespan);
        $('#msglist').append(rowdiv);
    }

    function checkInput() {
        var rtnObj = {
            result: false,
            name: '',
            score: -1,
            movetimes: -1,
            ip: ''
        };


        var name = $('#inputname').val();
        if (name !== '')
            rtnObj.name = name;

        var score = $('#inputscore').val();
        if (score !== '')
            rtnObj.score = parseInt(score);

        var movetimes = $('#inputtimes').val();
        if (movetimes !== '')
            rtnObj.movetimes = parseInt(movetimes);

        var ip = $('#inputip').val();
        if (ip !== '')
            rtnObj.ip = ip;

        if (name !== '' && score !== -1 && movetimes !== -1 && ip !== '')
            rtnObj.result = true;

        return rtnObj;
    }

    function clearInput() {
        $('#inputname').val('');
        $('#inputscore').val('');
        $('#inputtimes').val('');
        $('#inputip').val('');
    }
</script>
<div>
    <h4><span id="topTitle"></span></h4>

    <input type="button" id="atop10" value="Top10"/>
    <input type="button" id="atop50" value="Top50" />
</div>
    
    
    <div id="msglist" class="table" style="margin-bottom:10px;">

    </div>
    <div id="addMsgRow" class="table" style="margin-bottom:10px;">
        <div class="row">
            <div class="cell1">
                
            </div>
            <div class="cell1">
                <input id="inputname" type="text"/>
            </div>
            <div class="cell1">
                <input id="inputscore" type="number"/>
            </div>
            <div class="cell1">
                <input id="inputtimes" type="number"/>
            </div>
            <div class="cell1">
                <input id="inputip" type="text"/>
            </div>
            <div class="cell1">
                <input id="btnsend" type="button" value="Send"/>
            </div>
        </div>
    </div>
</body>
</html>